{% extends "allauth/layouts/main_base.html" %}
{% load i18n %}
{% load static %}
{% load markdownify %}
{% load allauth account %}
{% block head_title %}
{% trans "Profile" %}
{% endblock head_title %}
{% block stylesheet %}

{% endblock stylesheet %}
{% block pages %}

<section class="section_profile">
    <div class="row" style="padding: 1rem;padding-top: 0;">
        <div class="container-fluid">
            <div class="row">
                <div class="col-md-6" style="display: flex;align-items: center;justify-content: center;">
                    <img src="../../static/assets/img/landing/Forms-bro.svg" alt="" style="width: 400px;">
                </div>
                <div class="col-md-6">
                    <h1>Create a New Form</h1>
                    <form method="post" enctype="multipart/form-data" style="width: 100%;">
                        {% csrf_token %}
                        {{ form.as_p }}
                        <input type="hidden" id="extrapage" name="extrapage" value="false">
                        <div class="container">
                            <div class="row mb-3" style="padding: 1rem; padding-top: 0;">
                                <h4 style="color: white;" class="mb-3">Add Multiple Questions to Form: </h4>
                                        
                                    <div id="question-containers" class="row"></div> <!-- Container for all dynamic questions -->
                    
                                    <div class="col-md-12">
                                        <button type="button" class="btn btn-primary" onclick="addQuestion()">Add Question</button>
                                    </div>
                            </div>
                        </div>
                        <button type="submit" class="btn btn-success" onclick = "setExtraPage(true)" >Save and add another page</button>
                        <button type="submit" class="btn btn-success" onclick = "setExtraPage(false)" >Create Form</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

</section>

<script>

    function setExtraPage(value) {
        document.getElementById('extrapage').value = value;
    }
    // Function to show/hide input fields based on the selected question type
    function updateQuestionType(index) {
        const questionType = document.getElementById('question_type_' + index).value;
        const choicesContainer = document.getElementById('choices-container-' + index);

        // Hide all fields initially
        choicesContainer.style.display = 'none';

        // Show fields based on the selected question type
        if (questionType === 'MC' || questionType === 'DD') {
            choicesContainer.style.display = 'block'; // Show options for MC or DD
        }
    }

    // Function to add a new input field for more choices (MC/DD)
    function addChoiceField(index) {
        const container = document.getElementById('choices-container-' + index);

        // Create a new choice input field
        const newChoice = document.createElement('input');
        newChoice.type = 'text';
        newChoice.classList.add('form-control', 'mb-2');
        newChoice.name = 'choice_' + index + '[]'; // Unique name for each choice
        newChoice.placeholder = 'Option ' + (container.getElementsByTagName('input').length + 1);

        // Append the new choice input field to the container
        container.appendChild(newChoice);
    }

    // Function to dynamically add a new question
    function addQuestion() {
        const questionContainer = document.getElementById('question-containers');
        const index = questionContainer.children.length; // Get the number of existing question containers

        // Create a new question container with Bootstrap classes
        const newQuestion = document.createElement('div');
        newQuestion.classList.add('question-container', 'col-md-6', 'mb-4');

        // HTML content for the new question
        newQuestion.innerHTML = `
            <div class="card p-3">
                <div class="input-group mb-3">
                    <label for="question_text_${index}" class="form-label">Question Text:</label>
                    <input type="text" id="question_text_${index}" name="question_text_${index}" class="form-control" required>
                </div>

                <div class="input-group mb-3">
                    <label for="question_type_${index}" class="form-label">Question Type:</label>
                    <select id="question_type_${index}" name="question_type_${index}" class="form-select" onchange="updateQuestionType(${index})" required>
                        <option value="">Select type</option>
                        <option value="TEXT">Text</option>
                        <option value="MC">Multiple Choice</option>
                        <option value="SA">Short Answer</option>
                        <option value="LA">Long Answer</option>
                        <option value="DD">Dropdown</option>
                        <option value="DT">Date and Time</option>
                        <option value="IMG">Image</option>
                    </select>
                </div>

                <!-- Container for Multiple Choice or Dropdown options -->
                <div id="choices-container-${index}" class="input-group mb-3" style="display: none;">
                    <label class="form-label">Choices:</label>
                    <input type="text" class="form-control mb-2" name="choice_${index}[]" placeholder="Option 1">
                    <input type="text" class="form-control mb-2" name="choice_${index}[]" placeholder="Option 2">
                    <input type="text" class="form-control mb-2" name="choice_${index}[]" placeholder="Option 3">
                    <input type="text" class="form-control mb-2" name="choice_${index}[]" placeholder="Option 4">
                    <button type="button" class="btn btn-secondary" onclick="addChoiceField(${index})">Add another option</button>
                </div>

                <button type="button" class="btn btn-danger mt-2" onclick="removeQuestion(this)">Remove Question</button>
            </div>
        `;

        // Append the new question container to the main container
        questionContainer.appendChild(newQuestion);
        updateQuestionType(index); // Ensure the question type logic is applied for the new question
    }

    // Function to remove a question container
    function removeQuestion(button) {
        const questionContainer = button.closest('.question-container');
        questionContainer.remove();
    }

    // Initialize with one question form on page load
    window.onload = function() {
        addQuestion(); // Automatically add the first question
    }
</script>


{% endblock pages %}


