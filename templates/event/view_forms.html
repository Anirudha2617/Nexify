{% extends "allauth/layouts/main_base.html" %}
{% load i18n %}
{% load static %}
{% load markdownify %}
{% load allauth account %}
{% block head_title %}
{% trans "Profile" %}
{% endblock head_title %}
{% block stylesheet %}
<style>
    body {
        background-color: #0c1117;
        color: rgb(213, 211, 211);
        font-family: 'Arial', sans-serif;
        margin: 20px;
        padding: 0;
        line-height: 1.6;
    }

    h1 {
        text-align: center;
        color: white;
    }

    .form-type-group {
        margin-top: 30px;
    }

    .form-type-title {
        font-size: 1.5em;
        color: white;
        margin-bottom: 10px;
    }

    .form-list {
        list-style: none;
        padding: 0;
    }

    .form-card {
        background-color: #1b1f26;
        border: 1px solid #a19f9f;
        border-radius: 10px;
        margin: 15px 0;
        padding: 15px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        display: flex;
        align-items: center;
    }

    .form-image {
        max-width: 50px;
        height: auto;
        margin-right: 15px;
        border-radius: 5px;
    }

    .form-content {
        flex: 1;
    }

    .form-title {
        color: #299afd;
        font-weight: bold;
        font-size: 1.2em;
        text-decoration: none;
    }

    .form-title:hover {
        text-decoration: underline;
        color: #a19f9f;
    }

    .form-description {
        color: rgb(213, 211, 211);
        font-size: 1em;
    }

    .add-form-button {
        display: inline-block;
        text-align: center;
        background-color: #1abc9c;
        color: #fff;
        padding: 15px;
        border-radius: 50%;
        font-size: 2em;
        font-weight: bold;
        position: fixed;
        bottom: 20px;
        right: 20px;
        cursor: pointer;
        transition: background-color 0.3s ease;
    }

    .add-form-button:hover {
        background-color: #16a085;
    }

    a {
        text-decoration: none;
        color: #299afd;
    }

    a:hover {
        color: #a19f9f;
    }
</style>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
<style>
    .notification-card {
        margin-bottom: 20px;
        border: 1px solid #ddd;
        border-radius: 8px;
        padding: 20px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }
    .button-container button {
        margin: 5px;
    }
</style>

<style>
    body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 0;
        background-color: #121212; /* Black theme background */
        color: #e0e0e0; /* Light text for contrast */
    }

    #notificationBtn {
        top: 20px;
        right: 20px;
        padding: 10px 20px;
        font-size: 16px;
        cursor: pointer;
        background-color: #1e88e5; /* Blue color for button */
        color: white;
        border: none;
        border-radius: 5px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
        transition: background-color 0.3s ease;
    }

    #notificationBtn:hover {
        background-color: #1565c0; /* Slightly darker blue on hover */
    }

    .notification-panel {
        position: fixed;
        top: 0;
        right: -25%; /* Initially hidden */
        width: 25%; /* 1/4 of the screen */
        height: 100%;
        background-color: #1e1e1e; /* Dark grey for panel */
        box-shadow: -2px 0 5px rgba(0, 0, 0, 0.7); /* Stronger shadow */
        overflow-y: auto;
        transition: right 0.3s ease; /* Slide-in effect */
        z-index: 1000;
        color: #e0e0e0;
    }

    .notification-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 10px 15px;
        background-color: #424242; /* Slightly lighter grey for header */
        color: #ffffff;
    }

    .notification-header h3 {
        margin: 0;
        font-size: 18px;
    }

    .notification-header button {
        background: none;
        border: none;
        color: #ffffff;
        font-size: 24px;
        cursor: pointer;
    }

    .notification-header button:hover {
        color: #f44336; /* Red on hover for close button */
    }

    .notification-body {
        padding: 15px;
        font-size: 16px;
        background-color: #1e1e1e; /* Match panel background */
    }

    .notification-body p {
        margin: 10px 0;
        padding: 10px;
        background-color: #333333; /* Slightly lighter grey for notifications */
        border-radius: 5px;
        color: #e0e0e0;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
    }

    .notification-body p:hover {
        background-color: #424242; /* Highlight grey on hover */
    }
</style>

<link rel="stylesheet" href="{% static 'assets/css/forms/view_forms.css' %}">
{% endblock stylesheet %}
{% block pages %}

<section class="section_profile">
    <div class="row" style="padding: 1rem;padding-top: 0;">
        <h1 style="color: white;text-align: left;">What you want to host ðŸ¤Ÿ</h1>

        <button id="notificationBtn">Show Notifications</button>


        <section class="form-type-group {% if form_type == 'engaging' %}engaging-section{% else %}hiring-section{% endif %}">
            <h2 class="form-type-title">Create Events</h2>
            <ul class="form-list">
                {% for opportunity in opportunity_types %}
                    <li class="form-card">
                            <form action="{% url 'event:response_form' %}" class="form-content" >
                                {% csrf_token %}
                                <input type="hidden" name="event_no" value="{{ forloop.counter }}">
                                <a href="#" onclick="this.closest('form').submit(); return false;" class="form-title" >{{ opportunity }}</a>
                            </form>
                    </li>
                {% empty %}
                    <li>No opportunity_type available at the moment</li>
                {% endfor %}
            </ul>
        </section>
        
        <section class="form-type-group {% if form_type == 'engaging' %}engaging-section{% else %}hiring-section{% endif %}">
            <h2 class="form-type-title">Hosted Events</h2>
            <ul class="form-list">
                {% for response in hosted_events %}
                    <li class="form-card">                        
                        <div class="form-content">
                            <a href="{% url 'event:response_detail' response_id=response.id %}" class="form-title">{{ response.opportunity_title|slice:":21"}}{% if response.opportunity_title|length > 21 %}...{% endif %}</a>
                            <p class="form-description">
                                {{ response.about_opportunity|slice:":30" }}{% if response.about_opportunity|length > 30 %}...{% endif %}
                            </p>
                        </div>
                    </li>
                {% empty %}
                    <li>No forms available for this type</li>
                {% endfor %}
            </ul>
        </section>

        <section class="form-type-group {% if form_type == 'engaging' %}engaging-section{% else %}hiring-section{% endif %}">
            <h2 class="form-type-title">Invited Events</h2>
            <ul class="form-list">
                {% for response in invited_events %}
                    <li class="form-card">                        
                        <div class="form-content">
                            <a href="{% url 'event:response_detail' response_id=response.id %}" class="form-title">{{ response.opportunity_title|slice:":21"}}{% if response.opportunity_title|length > 21 %}...{% endif %}</a>
                            <p class="form-description">
                                {{ response.about_opportunity|slice:":30" }}{% if response.about_opportunity|length > 30 %}...{% endif %}
                            </p>
                        </div>
                    </li>
                {% empty %}
                    <li>No forms available for this type</li>
                {% endfor %}
            </ul>
        </section>

        <section class="form-type-group {% if form_type == 'engaging' %}engaging-section{% else %}hiring-section{% endif %}">
            <h2 class="form-type-title">Created Forms</h2>
            <a href={% url 'event:create_form' %} class="form-title" >Create Forms</a>
            <ul class="form-list">
                <li class="form-card">
                    <div class="form-content">
                        <a href={% url 'event:create_form' %} class="form-title" >Create Forms</a>
                    </div>
                </li>
                {% for form in crated_forms %}
                    <li class="form-card">
                        {% if form.image %}
                            <img src="{{ form.image.url }}" alt="{{ form.title }} image" class="form-image">
                        {% else %}
                            <img src="https://via.placeholder.com/50" alt="Default image" class="form-image">
                        {% endif %}
                        
                        <div class="form-content">
                            <a href="{% url 'event:view_form' form.id %}" class="form-title">{{ form.title|slice:":21"}}{% if form.title|length > 21 %}...{% endif %}</a>
                            <p class="form-description">
                                {{ form.description|slice:":30" }}{% if form.description|length > 30 %}...{% endif %}
                            </p>
                        </div>
                    </li>
                {% empty %}
                    <li>No forms available for this type</li>
                {% endfor %}
            </ul>
        </section>
        
        <section class="form-type-group {% if form_type == 'engaging' %}engaging-section{% else %}hiring-section{% endif %}">
            <h2 class="form-type-title">Invited Forms</h2>
            <ul class="form-list">
                {% for form in invited_forms %}
                    <li class="form-card">
                        {% if form.image %}
                            <img src="{{ form.image.url }}" alt="{{ form.title }} image" class="form-image">
                        {% else %}
                            <img src="https://via.placeholder.com/50" alt="Default image" class="form-image">
                        {% endif %}
                        
                        <div class="form-content">
                            <a href="{% url 'event:fill_form' form.id %}" class="form-title">{{ form.title|slice:":21"}}{% if form.title|length > 21 %}...{% endif %}</a>
                            <p class="form-description">
                                {{ form.description|slice:":30" }}{% if form.description|length > 30 %}...{% endif %}
                            </p>
                        </div>
                    </li>
                {% empty %}
                    <li>No forms available for this type</li>
                {% endfor %}
            </ul>
        </section>


        <div id="notificationPanel" class="notification-panel">
            <div class="notification-header">
                <h3>Notifications</h3>
                <button id="closePanelBtn">&times;</button>
            </div>
            <div class="notification-body">

                <section class="container mt-4 {% if form_type == 'engaging' %}engaging-section{% else %}hiring-section{% endif %}">
                    {% for notification in all_notifications %}
                        <div class="notification-card" id="card-{{ notification.id }}">
                            <h5>{{ notification.title }}</h5>
                            <p>{{ notification.message }}</p>
                            <div class="button-container" id="button-{{ notification.id }}">
                                <button type="button" class="btn btn-success" onclick="handleAction('{{ notification.id }}', 'accept')">Accept</button>
                                <button type="button" class="btn btn-danger" onclick="handleAction('{{ notification.id }}', 'reject')">Reject</button>
                            </div>
                            <!-- Hidden input field to store the state -->
                            <input type="hidden" name="card-{{ notification.id }}" id="state-{{ notification.id }}" value="">
                        </div>
                        {% empty %}
                            <li>No unread notifications available</li>
                    {% endfor %}
                </section>
            </div>
        </div>

        <section>
            <a href={% url 'event:create_form' %} >Create Forms</a>
        </section>
    </section>
<script>
    function handleAction(notificationId, action) {
        const card = document.getElementById(`card-${notificationId}`);
        const buttons = document.querySelectorAll(`#button-${notificationId} button`);
        const stateInput = document.getElementById(`state-${notificationId}`);
        
        // Disable buttons after an action
        buttons.forEach(button => button.disabled = true);
        const url = "{% url 'event:update_notification' %}?notificationId=" + encodeURIComponent(notificationId) + "&action=" + encodeURIComponent(action)
    
        // Send a request to the backend
        fetch(url)
            .then(response => {
                if (!response.ok) {
                    throw new Error(`Error: ${response.statusText}`);
                }
                return response.json();
            })
            .then(data => {
                if (data.status === 'success') {
                    // Update the hidden input
                    stateInput.value = action;
    
                    // Optional: Add visual feedback
                    if (action === 'accept') {
                        card.classList.add('border-success');
                        card.classList.remove('border-danger');
                    } else if (action === 'reject') {
                        card.classList.add('border-danger');
                        card.classList.remove('border-success');
                    }
                } else {
                    throw new Error(data.message);
                }
            })
            .catch(error => {
                console.error('Error updating notification:', error);
                buttons.forEach(button => button.disabled = false); // Re-enable buttons on error
                alert('There was an issue updating the notification. Please try again.');
            });
            
    }
    
</script>
  
<script>
    const notificationBtn = document.getElementById("notificationBtn");
    const notificationPanel = document.getElementById("notificationPanel");
    const closePanelBtn = document.getElementById("closePanelBtn");

    // Open the notification panel
    notificationBtn.onclick = () => {
        notificationPanel.style.right = "0";
    };

    // Close the notification panel
    closePanelBtn.onclick = () => {
        notificationPanel.style.right = "-25%";
    };

    // Close the panel when clicking outside (optional)
    window.onclick = (event) => {
        if (!notificationPanel.contains(event.target) && event.target !== notificationBtn) {
            notificationPanel.style.right = "-25%";
        }
    };
</script>

{% endblock pages %}
