{% extends "allauth/layouts/main_base.html" %}
{% load i18n %}
{% load static %}
{% load markdownify %}
{% load allauth account %}
{% block head_title %}
{% trans "Profile" %}
{% endblock head_title %}
{% block stylesheet %}
<link rel="stylesheet" href="{% static 'assets/css/forms/add_questions.css' %}">

    <style>
        .question-container {
            background-color: #0c1117;
            border: 1px solid #a19f9f;
            border-radius: 1rem;
            padding: 20px;
            margin-bottom: 20px;
            color: rgb(213, 211, 211);
        }
        .input-group {
            margin-bottom: 1em;
        }
        .input-group label {
            color: rgb(213, 211, 211);
            display: block;
            margin-bottom: 0.5em;
        }
        .input-group input,
        .input-group select {
            width: 100%;
            padding: 0.5em;
            margin-bottom: 1em;
            border-radius: 5px;
            border: 1px solid #a19f9f;
            background-color: #1b1f26;
            color: white;
        }
        button {
            border: 1px solid #a19f9f;
            border-radius: 5px;
            color: white;
            background-color: #0c1117;
            padding: 0.5em 1em;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        button:hover {
            background-color: #299afd;
        }
        .remove-question {
            color: red;
            cursor: pointer;
            border: none;
            background: none;
        }
        .card{
            background-color: #0c1117;
        }
    </style>
    {% endblock stylesheet %}
    {% block pages %}
    <script>
        // Function to show/hide input fields based on the selected question type
        function updateQuestionType(index) {
            const questionType = document.getElementById('question_type_' + index).value;
            const choicesContainer = document.getElementById('choices-container-' + index);
    
            // Hide all fields initially
            choicesContainer.style.display = 'none';
    
            // Show fields based on the selected question type
            if (questionType === 'MC' || questionType === 'DD') {
                choicesContainer.style.display = 'block'; // Show options for MC or DD
            }
        }
    
        // Function to add a new input field for more choices (MC/DD)
        function addChoiceField(index) {
            const container = document.getElementById('choices-container-' + index);
    
            // Create a new choice input field
            const newChoice = document.createElement('input');
            newChoice.type = 'text';
            newChoice.classList.add('form-control', 'mb-2');
            newChoice.name = 'choice_' + index + '[]'; // Unique name for each choice
            newChoice.placeholder = 'Option ' + (container.getElementsByTagName('input').length + 1);
    
            // Append the new choice input field to the container
            container.appendChild(newChoice);
        }
    
        // Function to dynamically add a new question
        function addQuestion() {
            const questionContainer = document.getElementById('question-containers');
            const index = questionContainer.children.length; // Get the number of existing question containers
    
            // Create a new question container with Bootstrap classes
            const newQuestion = document.createElement('div');
            newQuestion.classList.add('question-container', 'col-md-6', 'mb-4');
    
            // HTML content for the new question
            newQuestion.innerHTML = `
                <div class="card p-3">
                    <div class="input-group mb-3">
                        <label for="question_text_${index}" class="form-label">Question Text:</label>
                        <input type="text" id="question_text_${index}" name="question_text_${index}" class="form-control" required>
                    </div>
    
                    <div class="input-group mb-3">
                        <label for="question_type_${index}" class="form-label">Question Type:</label>
                        <select id="question_type_${index}" name="question_type_${index}" class="form-select" onchange="updateQuestionType(${index})" required>
                            <option value="">Select type</option>
                            <option value="TEXT">Text</option>
                            <option value="MC">Multiple Choice</option>
                            <option value="SA">Short Answer</option>
                            <option value="LA">Long Answer</option>
                            <option value="DD">Dropdown</option>
                            <option value="DT">Date and Time</option>
                            <option value="IMG">Image</option>
                        </select>
                    </div>
    
                    <!-- Container for Multiple Choice or Dropdown options -->
                    <div id="choices-container-${index}" class="input-group mb-3" style="display: none;">
                        <label class="form-label">Choices:</label>
                        <input type="text" class="form-control mb-2" name="choice_${index}[]" placeholder="Option 1">
                        <input type="text" class="form-control mb-2" name="choice_${index}[]" placeholder="Option 2">
                        <input type="text" class="form-control mb-2" name="choice_${index}[]" placeholder="Option 3">
                        <input type="text" class="form-control mb-2" name="choice_${index}[]" placeholder="Option 4">
                        <button type="button" class="btn btn-secondary" onclick="addChoiceField(${index})">Add another option</button>
                    </div>
    
                    <button type="button" class="btn btn-danger mt-2" onclick="removeQuestion(this)">Remove Question</button>
                </div>
            `;
    
            // Append the new question container to the main container
            questionContainer.appendChild(newQuestion);
            updateQuestionType(index); // Ensure the question type logic is applied for the new question
        }
    
        // Function to remove a question container
        function removeQuestion(button) {
            const questionContainer = button.closest('.question-container');
            questionContainer.remove();
        }
    
        // Initialize with one question form on page load
        window.onload = function() {
            addQuestion(); // Automatically add the first question
        }
    </script>
    
    <section class="section_profile">
        <div class="container">
            <div class="row mb-3" style="padding: 1rem; padding-top: 0;">
                <h4 style="color: white;" class="mb-3">Add Multiple Questions to Form: {{ form.title }}</h4>
    
                <form method="post" enctype="multipart/form-data">
                    {% csrf_token %}
    
                    <div id="question-containers" class="row"></div> <!-- Container for all dynamic questions -->
    
                    <div class="col-md-12">
                        <button type="button" class="btn btn-primary" onclick="addQuestion()">Add Question</button>
                        <button type="submit" class="btn btn-success">Save Questions</button>
                    </div>
                </form>
            </div>
        </div>
    </section>
    
    {% endblock pages %}

